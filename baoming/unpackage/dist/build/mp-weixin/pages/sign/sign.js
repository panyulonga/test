(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/sign/sign"],{"42b3":function(t,e,o){"use strict";(function(t){o("9f11");n(o("66fd"));var e=n(o("d969"));function n(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,o("543d")["createPage"])},6775:function(t,e,o){"use strict";o.r(e);var n=o("d43c"),a=o.n(n);for(var i in n)"default"!==i&&function(t){o.d(e,t,(function(){return n[t]}))}(i);e["default"]=a.a},"75f5":function(t,e,o){},ae2d:function(t,e,o){"use strict";var n;o.d(e,"b",(function(){return a})),o.d(e,"c",(function(){return i})),o.d(e,"a",(function(){return n}));var a=function(){var t=this,e=t.$createElement;t._self._c},i=[]},d43c:function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=a(o("95d2"));function a(t){return t&&t.__esModule?t:{default:t}}var i={data:function(){return{infoList:"",info_list:[],sign_info:[],list_img:{path:"",id:""},personInfo:{openid:"",method:"create",type:"article",token:""},info_data:{},bl:!1,top_background:"background:none;color:#fff;",top_background_imgurl:"../../static/assets/arrow-left-bold1.png",top_style:"",top_height:"",optionData:"",jumpInfo:!1}},created:function(){console.log(t.getMenuButtonBoundingClientRect());var e=t.getMenuButtonBoundingClientRect(),o=(e.height-40)/2;this.top_height="height:"+(e.top+o)+"px",this.top_style="top:"+(e.top+o)+"px"},onLoad:function(e){var o=this;this.personInfo.token=t.getStorageSync("names","data").token;var a=getCurrentPages(),i=a[a.length-1].route;this.curRoutes=i,t.request({url:n.default.WEBSITE_URL+"/api/competition/getConfig",success:function(t){0==t.data.code&&(o.infoList=t.data.data)}}),(e.type="")?this.optionData="":this.optionData=e.type,this.articleDetails()},onShow:function(){var e=this;this.personInfo.token=t.getStorageSync("names","data").token,this.jumpInfo&&t.request({method:"POST",url:n.default.WEBSITE_URL+"/api/competition/getRegistration?token="+this.personInfo.token+"&channel="+n.default.CHANNEL,success:function(o){if(console.log(o.data,Object.keys(o.data.data).length),0==o.data.code&&(o.data.data.length>0||Object.keys(o.data.data).length>0)){var a=0;for(var i in o.data.data)"[object Object]"===Object.prototype.toString.call(e.info_list[a])?e.info_list[a].path=o.data.data[i]:e.info_list[a]=o.data.data[i],a++;console.log(e.info_list),t.showToast({icon:"none",title:"已报名，正在前往作品界面"}),e.$forceUpdate(),t.request({url:n.default.WEBSITE_URL+"/api/competition/getAllSubmission?token="+e.personInfo.token+"&channel="+n.default.CHANNEL,success:function(o){console.log("panyulong",o.data),0==o.data.code&&(console.log(t.getStorageSync("type","data")),o.data.data.article.length>0?(console.log(e.articles),t.setStorageSync("type","article")):o.data.data.miniapp.length>0?t.setStorageSync("type","miniapp"):o.data.data.video.length>0&&t.setStorageSync("type","video"),console.log(t.getStorageSync("type","data"))),setTimeout((function(){t.navigateTo({url:"/pages/sign_info/sign_info?type=".concat(t.getStorageSync("type","data"))})}),1e3)}})}}})},onShareAppMessage:function(t){return{title:this.infoList.share_title,path:this.curRoutes,imageUrl:this.infoList.share_cover}},onShareTimeline:function(t){return{title:this.infoList.share_title,path:this.curRoutes,imageUrl:this.infoList.share_cover}},methods:{submitInfo:function(){if(console.log(this.personInfo.token),this.personInfo.token){for(var e in this.bl=!1,this.sign_info)"none"==this.sign_info[e].resource_type?this.info_data[this.sign_info[e].key]=this.info_list[e]:this.info_data[this.sign_info[e].key]=this.info_list[e].id;t.request({method:"POST",url:n.default.WEBSITE_URL+"/api/competition/register?token="+this.personInfo.token+"&channel="+n.default.CHANNEL,data:this.info_data,success:function(e){console.log(e.data),0==e.data.code?(t.showToast({icon:"none",title:"已报名，正在前往作品界面"}),t.requestSubscribeMessage({tmplIds:["mykssE5OuoErGJWoKQYCHFy8wKY2TrSVVxC5rUX_mJQ"],success:function(e){"requestSubscribeMessage:ok"==e.errMsg&&setTimeout((function(){t.navigateTo({url:"/pages/sign_info/sign_info?type=".concat(t.getStorageSync("type","data"))})}),1e3)}})):2==e.data.code?(t.showToast({icon:"none",title:e.data.msg}),setTimeout((function(){t.reLaunch({url:"../sign/sign"})}),2e3)):t.showToast({icon:"none",title:e.data.msg})}})}else t.showToast({title:"暂未登录",icon:"none"}),this.jumpInfo=!0,setTimeout((function(){t.navigateTo({url:"/pages/login/login?jump=sign"})}),1500)},articleDetails:function(){var e=this;t.request({url:n.default.WEBSITE_URL+"/api/competition/getRegistrationForm",success:function(o){if(0==o.data.code){e.sign_info=o.data.data;for(var a=0;a<e.sign_info.length;a++)"image"==e.sign_info[a].resource_type||"video"==e.sign_info[a].resource_type?e.info_list[a]={path:"",id:""}:e.info_list[a]="";console.log(e.sign_info),t.request({method:"POST",url:n.default.WEBSITE_URL+"/api/competition/getRegistration?token="+e.personInfo.token+"&channel="+n.default.CHANNEL,success:function(o){if(console.log(o.data,Object.keys(o.data.data).length),0==o.data.code&&(o.data.data.length>0||Object.keys(o.data.data).length>0)){var n=0;for(var a in o.data.data)"[object Object]"===Object.prototype.toString.call(e.info_list[n])?e.info_list[n].path=o.data.data[a]:e.info_list[n]=o.data.data[a],n++;console.log(e.info_list),t.showToast({icon:"none",title:"已报名，正在前往作品界面"}),e.$forceUpdate(),setTimeout((function(){t.navigateTo({url:"/pages/sign_info/sign_info?type=".concat(t.getStorageSync("type","data"))})}),2e3)}}})}}})},del_img:function(t){this.info_list[t].path="",this.info_list[t].id="",this.$forceUpdate()},bindPickerChange:function(t){this.index=t.target.value,this.jg=this.array[this.index]},indexJump:function(e){t.navigateTo({url:"/pages/".concat(e,"/").concat(e)})},imreturn:function(){t.navigateBack()},uploadImg:function(e,o,a){var i=this;t.chooseImage({count:1,success:function(s){t.showLoading({title:"图片上传中"}),s.size>n.default.MAXIMAGE&&t.showModal({title:"错误",content:"上传失败,超过10M",showCancel:!1}),s.tempFilePaths.forEach((function(s){t.uploadFile({url:n.default.WEBSITE_URL+"/api/api/multimediaUpload?channel="+n.default.CHANNEL+"&token="+i.personInfo.token+"&key="+e+"&module="+a+"&type=image",filePath:s,name:e,success:function(e){if(e.data)try{console.log(e.data);var n=JSON.parse(e.data);if(console.log(n),0!=n.code)return t.showModal({title:"错误",content:"上传失败",showCancel:!1}),void t.hideLoading();t.hideLoading(),console.log(o,n),i.info_list[o].path=n.data.url,i.info_list[o].id=n.data.file_id,this.$forceUpdate()}catch(a){console.log(2),t.showModal({title:"错误",content:"上传失败",showCancel:!1}),t.hideLoading()}}})}))}})},addVideoFun:function(e,o){var a=this;t.chooseVideo({count:1,success:function(i){var s=this;t.showLoading({title:"视频上传中"}),console.log(i),t.uploadFile({url:n.default.WEBSITE_URL+"/api/api/multimediaUpload?channel="+n.default.CHANNEL+"&token="+a.personInfo.token+"&key=video&module="+o+"&type=video",filePath:i.tempFilePath,name:"video",header:{Authorization:"Bearer "+t.getStorageSync("access")},success:function(o){t.hideLoading();var n=JSON.parse(o.data);console.log(n),0==n.code?(t.hideLoading(),a.info_list[e].path=n.data.url,a.info_list[e].id=n.data.file_id,s.$forceUpdate()):t.showModal({title:"错误",content:"上传失败",showCancel:!1})}})}})},returnHome:function(){t.reLaunch({url:"../index/index"})},onPageScroll:function(t){var e=t.scrollTop;e<=10?(this.top_background="background:none;color:#fff;",this.top_background_imgurl="../../static/assets/arrow-left-bold1.png"):(this.top_background="background:rgba(255,255,255,1);color:#333;",this.top_background_imgurl="../../static/assets/arrow-left-bold.png")}}};e.default=i}).call(this,o("543d")["default"])},d969:function(t,e,o){"use strict";o.r(e);var n=o("ae2d"),a=o("6775");for(var i in a)"default"!==i&&function(t){o.d(e,t,(function(){return a[t]}))}(i);o("dc6e");var s,c=o("f0c5"),l=Object(c["a"])(a["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],s);e["default"]=l.exports},dc6e:function(t,e,o){"use strict";var n=o("75f5"),a=o.n(n);a.a}},[["42b3","common/runtime","common/vendor"]]]);